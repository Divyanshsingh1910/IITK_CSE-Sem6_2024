cscope 15 $HOME/Desktop/CS_614               0000009122
	@chdev/simplecdev.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/k”Ãl.h
>

3 
	~<lšux/mm.h
>

4 
	~<lšux/mm_ty³s.h
>

5 
	~<lšux/fe.h
>

6 
	~<lšux/fs.h
>

7 
	~<lšux/·th.h
>

8 
	~<lšux/¦ab.h
>

9 
	~<lšux/dÿche.h
>

10 
	~<lšux/sched.h
>

11 
	~<lšux/uacûss.h
>

12 
	~<lšux/fs_¡ruù.h
>

13 
	~<asm/bæush.h
>

14 
	~<lšux/uacûss.h
>

15 
	~<lšux/deviû.h
>

18 
	#DEVNAME
 "democdev"

	)

20 
	gmajÜ
;

21 
©omic_t
 
	gdeviû_İ’ed
;

22 
	gcouÁ_»ad
;

23 
şass
 *
	gdemo_şass
;

24 
deviû
 *
	gdemo_deviû
;

26 *
	gd_buf
 = 
NULL
;

29 
	$demo_İ’
(
šode
 *šode, 
fe
 *file)

31 
	`©omic_šc
(&
deviû_İ’ed
);

32 
	`Œy_moduË_g‘
(
THIS_MODULE
);

33 
	`´štk
(
KERN_INFO
 "Device opened successfully\n");

35 
	}
}

37 
	$demo_»Ëa£
(
šode
 *šode, 
fe
 *file)

39 
	`©omic_dec
(&
deviû_İ’ed
);

40 
	`moduË_put
(
THIS_MODULE
);

41 
	`´štk
(
KERN_INFO
 "Device closed successfully\n");

43 
	}
}

45 
ssize_t
 
	$demo_»ad
(
fe
 *
fp
,

46 *
ubuf
,

47 
size_t
 
Ëngth
,

48 
loff_t
 * 
off£t
)

50 
d_buf
[100] = "mcdivyansh\n";

53 if(
	`cİy_to_u£r
(
ubuf
, 
d_buf
, 5))

54  -
EINVAL
;

55 
	`´štk
(
KERN_INFO
 "In„ead \n");

56 ià(
couÁ_»ad
>5){

57 
	`´štk
(
KERN_INFO
 "Ho gya bhai iskaoh\n");

61 
couÁ_»ad
++;

63 
	}
}

65 
ssize_t


66 
	$demo_wr™e
(
fe
 *
fp
, cÚ¡ *
buff
, 
size_t
 
Ën
, 
loff_t
 * 
off
)

68 if(
	`cİy_äom_u£r
(
d_buf
, 
buff
, 
Ën
))

69  -
EINVAL
;

70 
	`´štk
(
KERN_INFO
 "In write\n");

72 
	}
}

74 
fe_İ”©iÚs
 
	gfİs
 = {

75 .
»ad
 = 
demo_»ad
,

76 .
	gwr™e
 = 
demo_wr™e
,

77 .
	gİ’
 = 
demo_İ’
,

78 .
	g»Ëa£
 = 
demo_»Ëa£
,

82 *
	$demo_devnode
(
deviû
 *
dev
, 
umode_t
 *
mode
)

84 ià(
mode
 && 
dev
->
devt
 =ğ
	`MKDEV
(
majÜ
, 0))

85 *
mode
 = 0666;

86  
NULL
;

87 
	}
}

89 
	$š™_moduË
()

91 
”r
;

92 
	`´štk
(
KERN_INFO
 "Hello kernel\n");

94 
majÜ
 = 
	`»gi¡”_chrdev
(0, 
DEVNAME
, &
fİs
);

95 
”r
 = 
majÜ
;

96 ià(
”r
 < 0) {

97 
	`´štk
(
KERN_ALERT
 "Regi¡”šg ch¬ deviû faed w™h %d\n", 
majÜ
);

98 
”rÜ_»gdev
;

101 
demo_şass
 = 
	`şass_ü—‹
(
THIS_MODULE
, 
DEVNAME
);

102 
”r
 = 
	`PTR_ERR
(
demo_şass
);

103 ià(
	`IS_ERR
(
demo_şass
))

104 
”rÜ_şass
;

106 
demo_şass
->
devnode
 = 
demo_devnode
;

108 
demo_deviû
 = 
	`deviû_ü—‹
(
demo_şass
, 
NULL
,

109 
	`MKDEV
(
majÜ
, 0),

110 
NULL
, 
DEVNAME
);

111 
”r
 = 
	`PTR_ERR
(
demo_deviû
);

112 ià(
	`IS_ERR
(
demo_deviû
))

113 
”rÜ_deviû
;

115 
d_buf
 = 
	`kz®loc
(4096, 
GFP_KERNEL
);

116 
	`´štk
(
KERN_INFO
 "I wa assigÃd majÜ‚umb” %d. TØlko\n", 
majÜ
);

117 
	`©omic_£t
(&
deviû_İ’ed
, 0);

122 
”rÜ_deviû
:

123 
	`şass_de¡roy
(
demo_şass
);

124 
”rÜ_şass
:

125 
	`uÄegi¡”_chrdev
(
majÜ
, 
DEVNAME
);

126 
”rÜ_»gdev
:

127  
”r
;

128 
	}
}

130 
	$ş—nup_moduË
()

132 
	`kä“
(
d_buf
);

133 
	`deviû_de¡roy
(
demo_şass
, 
	`MKDEV
(
majÜ
, 0));

134 
	`şass_de¡roy
(
demo_şass
);

135 
	`uÄegi¡”_chrdev
(
majÜ
, 
DEVNAME
);

136 
	`´štk
(
KERN_INFO
 "Goodbye kernel\n");

137 
	}
}

139 
MODULE_AUTHOR
("deba@cse.iitk.ac.in");

140 
MODULE_LICENSE
("GPL");

141 
MODULE_DESCRIPTION
("Demo modules");

	@chdev/simplecdev.mod.c

1 
	~<lšux/moduË.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<lšux/bud-§É.h
>

4 
	~<lšux/–âÙe-Éo.h
>

5 
	~<lšux/expÜt-š‹º®.h
>

6 
	~<lšux/v”magic.h
>

7 
	~<lšux/comp”.h
>

9 
	gBUILD_SALT
;

10 
	gBUILD_LTO_INFO
;

12 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

13 
MODULE_INFO
(
Çme
, 
KBUILD_MODNAME
);

15 
__visibË
 
moduË
 
__this_moduË


16 
__£ùiÚ
(".gnu.linkonce.this_module") = {

17 .
Çme
 = 
KBUILD_MODNAME
,

18 .
	gš™
 = 
š™_moduË
,

19 #ifdeà
CONFIG_MODULE_UNLOAD


20 .
	gex™
 = 
ş—nup_moduË
,

22 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

25 #ifdeà
CONFIG_RETPOLINE


26 
MODULE_INFO
(
»Şše
, "Y");

30 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

31 
__u£d
 
__£ùiÚ
("__versions") = {

53 
MODULE_INFO
(
d•’ds
, "");

56 
MODULE_INFO
(
¤cv”siÚ
, "A2FB9CB40E2190D8AD9E14B");

	@chdev/testcdev.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

4 
	~<sys/fú.h
>

5 
	~<sigÇl.h
>

6 
	~<sys/ioùl.h
>

7 
	~<sys/mmª.h
>

8 
	~<sys/uni¡d.h
>

10 
	$maš
()

12 
rbuf
[4096]= {0};

14 
fd
 = 
	`İ’
("/dev/democdev",
O_RDWR
);

18 if(
fd
 < 0){

19 
	`³¼Ü
("open");

20 
	`ex™
(-1);

24 if(
	`wr™e
(
fd
, "Hello CS614!", 12) < 0){

25 
	`³¼Ü
("write");

26 
	`ex™
(-1);

30 if(
	`»ad
(
fd
, 
rbuf
, 4096) < 0){

31 
	`³¼Ü
("read");

32 
	`ex™
(-1);

35 
	`´štf
("R—d: %s\n", 
rbuf
);

36 
	`şo£
(
fd
);

38 
	}
}

	@hello_mod/hello.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/k”Ãl.h
>

3 
	~<lšux/sched.h
>

5 
	$š™_moduË
()

7 
buf
[16];

8 
	`g‘_sk_comm
(
buf
, 
cu¼’t
);

9 
	`´štk
(
KERN_INFO
 "H–lØk”ÃÈäom cs614,hi i thadd™iÚ oà¨Ãw moduË.\ÀThšfÜm©iÚ ¬e:…id = %d‚amğ%s\n", 
cu¼’t
->
pid
, 
buf
);

11 
	}
}

13 
	$ş—nup_moduË
()

15 
buf
[16];

16 
	`g‘_sk_comm
(
buf
, 
cu¼’t
);

17 
	`´štk
(
KERN_INFO
 "Goodbyk”Ãl,hmoduË ha b“Àd‘ached.\ÀThšfÜm©iÚ ¬e:…id = %d‚amğ%s\n", 
cu¼’t
->
pid
, 
buf
);

18 
	}
}

19 
MODULE_LICENSE
("GPL");

	@hello_mod/hello.mod.c

1 
	~<lšux/moduË.h
>

2 
	#INCLUDE_VERMAGIC


	)

3 
	~<lšux/bud-§É.h
>

4 
	~<lšux/–âÙe-Éo.h
>

5 
	~<lšux/expÜt-š‹º®.h
>

6 
	~<lšux/v”magic.h
>

7 
	~<lšux/comp”.h
>

9 
	gBUILD_SALT
;

10 
	gBUILD_LTO_INFO
;

12 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

13 
MODULE_INFO
(
Çme
, 
KBUILD_MODNAME
);

15 
__visibË
 
moduË
 
__this_moduË


16 
__£ùiÚ
(".gnu.linkonce.this_module") = {

17 .
Çme
 = 
KBUILD_MODNAME
,

18 .
	gš™
 = 
š™_moduË
,

19 #ifdeà
CONFIG_MODULE_UNLOAD


20 .
	gex™
 = 
ş—nup_moduË
,

22 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

25 #ifdeà
CONFIG_RETPOLINE


26 
MODULE_INFO
(
»Şše
, "Y");

30 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

31 
__u£d
 
__£ùiÚ
("__versions") = {

41 
MODULE_INFO
(
d•’ds
, "");

44 
MODULE_INFO
(
¤cv”siÚ
, "9984B86EC77CD74DA4C8393");

	@module_prog/chardev.c

	@module_prog/hello1.c

2 
	~<lšux/moduË.h
>

3 
	~<lšux/k”Ãl.h
>

5 
MODULE_LICENSE
("GPL");

7 
	$š™_moduË
(){

9 
	`´štk
("Hello World, I‡mhe‚ew module.\n");

13 
	}
}

15 
	$ş—nup_moduË
(){

16 
	`´štk
("By kernel, see ya!\n");

18 
	}
}

	@traphook-sysfs/traphook.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/k”Ãl.h
>

3 
	~<lšux/sched.h
>

4 (*
Œ­_çuÉ_hook
)(
±_»gs
 *
»gs
, 
”rÜ_code
, 
Œ­Ä
);

5 
’abËd
 = 0;

7 
	$my_hªdËr
(
±_»gs
 *
»gs
, 
”rÜ_code
, 
Œ­Ä
)

9 
sk_¡ruù
 *
tsk
 = 
cu¼’t
;

10 
	`´štk
(
KERN_INFO
 "GÙ¿p/çuÉ %ld fÜ…id = %d @%lx\n", 
Œ­Ä
, 
tsk
->
pid
, 
»gs
->

);

11 
»gs
->

 += 2;

14 
	}
}

15 
ssize_t
 
	$Œ­hook_¡©us
(
kobjeù
 *
kobj
,

16 
kobj_©Œibu‹
 *
©Œ
, *
buf
)

18  
	`¥rštf
(
buf
, "%d\n", 
’abËd
);

19 
	}
}

21 
ssize_t
 
	$Œ­hook_£t
(
kobjeù
 *
kobj
,

22 
kobj_©Œibu‹
 *
©Œ
,

23 cÚ¡ *
buf
, 
size_t
 
couÁ
)

25 
Ãwv®
;

26 
”r
 = 
	`k¡¹ošt
(
buf
, 10, &
Ãwv®
);

27 ià(
”r
 || 
Ãwv®
 < 0 ||‚ewval > 1 )

28  -
EINVAL
;

30 if(
’abËd
 && !
Ãwv®
)

31 
Œ­_çuÉ_hook
 = 
NULL
;

32 if(!
’abËd
 && 
Ãwv®
)

33 
Œ­_çuÉ_hook
 = &
my_hªdËr
;

34 
’abËd
 = 
Ãwv®
;

36  
couÁ
;

37 
	}
}

39 
kobj_©Œibu‹
 
	gŒ­hook_©Œibu‹
 = 
__ATTR
(
Œ­hook
, 0644, 
Œ­hook_¡©us
, 
Œ­hook_£t
);

40 
©Œibu‹
 *
	gŒ­hook_©Œs
[] = {

41 &
Œ­hook_©Œibu‹
.
©Œ
,

42 
NULL
,

44 
©Œibu‹_group
 
	gŒ­hook_©Œ_group
 = {

45 .
©Œs
 = 
Œ­hook_©Œs
,

46 .
	gÇme
 = "cs614hook",

49 
	$š™_moduË
()

51 
»t
 = 
	`sysfs_ü—‹_group
 (
k”Ãl_kobj
, &
Œ­hook_©Œ_group
);

52 if(
	`uÆik–y
(
»t
))

53 
	`´štk
(
KERN_INFO
 "demo: can't create sysfs\n");

55 
	`´štk
(
KERN_INFO
 "All seto…lay\n");

57 
	}
}

59 
	$ş—nup_moduË
()

61 
	`sysfs_»move_group
 (
k”Ãl_kobj
, &
Œ­hook_©Œ_group
);

62 
Œ­_çuÉ_hook
 = 
NULL
;

63 
	`´štk
(
KERN_INFO
 "Removedherap hook handler\n");

64 
	}
}

65 
MODULE_LICENSE
("GPL");

	@traphook/traphook.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/k”Ãl.h
>

3 
	~<lšux/sched.h
>

4 (*
Œ­_çuÉ_hook
)(
±_»gs
 *
»gs
, 
”rÜ_code
, 
Œ­Ä
);

5 (*
sysÿÎ_hook
)(
±_»gs
 *
»gs
, 
sy¢r
);

7 
	$my_Œ­_hªdËr
(
±_»gs
 *
»gs
, 
”rÜ_code
, 
Œ­Ä
)

9 
¥
;

10 
sk_¡ruù
 *
tsk
 = 
cu¼’t
;

11 
	`´štk
(
KERN_INFO
 "GÙ¿p/çuÉ %ld fÜ…id = %d RIP#%lx RSP#%lx RBP#%lx\n", 
Œ­Ä
, 
tsk
->
pid
, 
»gs
->

,„egs->
¥
,„egs->
bp
);

12 
asm
 volatile("mov %%rsp, %0;"

13 :"ô"(
¥
)

17 
	`´štk
(
KERN_INFO
 "K”ÃÈRSP#%lx„egs#%lx hªdËr#%lx\n",
¥
, ()
»gs
, ()
Œ­_çuÉ_hook
);

20 
	}
}

21 
	$my_sysÿÎ_hªdËr
(
±_»gs
 *
»gs
, 
sy¢r
)

23 
¥
;

24 
sk_¡ruù
 *
tsk
 = 
cu¼’t
;

25 if(!
	`memcmp
(
cu¼’t
->
comm
, "a.out", 5è&& 
sy¢r
 == 1){

26 
	`´štk
(
KERN_INFO
 "Sy¡em c®ÈfÜ…id = %d RIP#%lx RSP#%lx RBP#%lx\n", 
tsk
->
pid
, 
»gs
->

,„egs->
¥
,„egs->
bp
);

27 
asm
 volatile("mov %%rsp, %0;"

28 :"ô"(
¥
)

32 
	`´štk
(
KERN_INFO
 "K”ÃÈRSP#%lx„egs#%lx hªdËr#%lx\n",
¥
, ()
»gs
, ()
sysÿÎ_hook
);

35 
	}
}

37 
	$š™_moduË
()

39 
	`´štk
(
KERN_INFO
 "Settingherap hook handler\n");

40 
Œ­_çuÉ_hook
 = &
my_Œ­_hªdËr
;

41 
sysÿÎ_hook
 = &
my_sysÿÎ_hªdËr
;

43 
	}
}

45 
	$ş—nup_moduË
()

47 
Œ­_çuÉ_hook
 = 
NULL
;

48 
sysÿÎ_hook
 = 
NULL
;

49 
	`´štk
(
KERN_INFO
 "Removedherap hook handler\n");

50 
	}
}

51 
MODULE_LICENSE
("GPL");

	@
1
.
0
9
188
chdev/simplecdev.c
chdev/simplecdev.mod.c
chdev/testcdev.c
hello_mod/hello.c
hello_mod/hello.mod.c
module_prog/chardev.c
module_prog/hello1.c
traphook-sysfs/traphook.c
traphook/traphook.c
